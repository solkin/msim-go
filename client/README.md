# mSIM Chat Client

Консольный чат-клиент с terminal UI в стиле Midnight Commander для протокола mSIM.

## Сборка

```bash
cd client
go mod tidy
go build -o msim-chat .
```

## Запуск

```bash
# Подключение к локальному серверу (по умолчанию localhost:3215)
./msim-chat

# Подключение к удалённому серверу
./msim-chat -server example.com:3215
```

## Интерфейс

### Экран авторизации

При запуске отображается модальное окно авторизации поверх серого фона.

- **Tab** — переключение между полями
- **Enter** — подтвердить ввод
- **Login** — вход в существующий аккаунт
- **Register** — регистрация нового аккаунта (с автоматическим входом)
- **Quit** — выход

### Главный экран

После авторизации отображается:
- **Список контактов** — с именем, ID, статусом (● online / ○ offline) и счётчиком непрочитанных
- **Панель подключения** — статус соединения и время с последнего ping
- **Статус-бар** — доступные горячие клавиши

#### Горячие клавиши

| Клавиша | Действие |
|---------|----------|
| **F1** | Справка |
| **F2** | Добавить контакт |
| **F3** | Переименовать выбранный контакт |
| **F4** | Удалить выбранный контакт |
| **F5** | Обновить список контактов и статусы |
| **F6** | Подключиться / Отключиться |
| **F10 / Esc** | Выход из приложения |
| **Enter** | Открыть чат с выбранным контактом |
| **↑ / ↓** | Навигация по списку |

### Экран чата

При открытии чата отображается:
- **Заголовок** — имя контакта и его статус (online/offline)
- **История сообщений** — с временными метками и индикаторами доставки
- **Поле ввода** — для отправки сообщений
- **Статус-бар** — доступные горячие клавиши

#### Цвета сообщений

- **→ белые** — исходящие сообщения
- **← жёлтые** — входящие сообщения

#### Горячие клавиши

| Клавиша | Действие |
|---------|----------|
| **Enter** | Отправить сообщение |
| **Tab** | Переключиться в режим прокрутки |
| **F5** | Обновить историю |
| **F8** | Очистить историю |
| **Esc** | Вернуться к списку контактов |

#### Режим прокрутки (после Tab)

| Клавиша | Действие |
|---------|----------|
| **↑ / ↓** | Прокрутка на одну строку |
| **PgUp / PgDn** | Прокрутка на 10 строк |
| **Home** | В начало истории |
| **End** | В конец истории |
| **Tab / Esc** | Вернуться к вводу сообщения |

## Индикаторы

### Статус контакта

- **●** зелёный — пользователь онлайн
- **○** серый — пользователь оффлайн
- **(N)** красный — количество непрочитанных сообщений

### Статус сообщения

- **✓** зелёный — сообщение доставлено (получено подтверждение ack)
- **○** серый — сообщение отправлено (ожидается подтверждение)

### Статус подключения

- **● Connected** — активное соединение с сервером
- **○ Disconnected** — нет соединения
- **✗ Error** — ошибка подключения
- **Last ping: Ns ago** — время с последнего успешного ping-pong

## Особенности

### Протокол

- Автоматическая отправка **ping** каждые 30 секунд для поддержания соединения
- Автоматическое **подтверждение доставки (ack)** входящих сообщений
- Корректное завершение сессии командой **bye** при выходе
- Обработка событий **bye** от сервера (timeout, maintenance, restart)
- Поддержка **экранирования** специальных символов (`|`, `,`, `\n`) в сообщениях

### Контакты

- Отображение статусов контактов **в реальном времени** (on/off события)
- **Автоматическое добавление** неизвестных отправителей в контакты
- При отключении все статусы сбрасываются в offline

### Сообщения

- Загрузка **истории сообщений** при открытии чата
- Получение сообщений **в реальном времени**
- Отображение времени отправки (HH:MM:SS)
- Индикаторы доставки обновляются в реальном времени
- **Счётчики непрочитанных** — количество сообщений, полученных пока вы были оффлайн
- Счётчик **увеличивается** при получении нового сообщения (если чат не открыт)
- Счётчик **сбрасывается** при открытии чата с контактом

### Подключение

- Возможность **отключиться и переподключиться** без перезапуска (F6)
- Отображение **статуса подключения** с временем последнего ping
- При попытке открыть чат без подключения — показ ошибки

## Требования

- Go 1.21+
- Терминал с поддержкой UTF-8 и 256 цветов
- Рекомендуемый размер терминала: 80x24 и больше
